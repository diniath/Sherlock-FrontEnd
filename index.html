<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hotel Search</title>
    <!-- CSS only -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1" crossorigin="anonymous">
    <!-- JavaScript Bundle with Popper
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ygbV9kiqUc6oa4msXn9868pTtWMgiQaeYH7/t7LECLbyPA2x65Kgf80OJFdroafW"
        crossorigin="anonymous"></script> -->

    <!-- fontawesome icons -->
    <!-- TODO: fix search icon -->
    <link rel="stylesheet" href="/assignment5/css/fontawesome/css/all.min.css">
    <style>
        header {
            background-color: #37454d;
            height: 180px;
        }

        .box {
            display: flex;
            align-items: center;
        }

        .bg-search {
            background-color: #007fad;
            color: white;
        }

        .checkIn {
            margin-left: 9px;
            padding-left: 1px;
            border-left: 7px solid #007fad;
            border-top-left-radius: 0.25rem;
            border-bottom-left-radius: 0.25rem;
            /* border-top-right-radius: 0rem !important;
        border-bottom-right-radius: 0rem !important; */
        }

        .checkOut {
            padding-left: 1px;
            border-left: 7px solid orange;
            border-top-left-radius: 0.25rem;
            border-bottom-left-radius: 0.25rem;
            color: lightslategrey !important;
            /* border-top-right-radius: 0rem !important; */
            /* border-bottom-right-radius: 0rem !important; */
        }

        #selectroomtype {
            border-color: transparent;
            background: whitesmoke;
            text-align: center;
            width: 100%;
            color: lightslategrey;
        }

        .header-titles {
            color: whitesmoke;
            font-size: 10px;
            justify-content: space-between;
        }

        .text-right {
            margin-left: 130px;
        }

        /* .text-left {
            align-self: start;
        } */

        span {
            padding-left: 30px;
        }

        #price {
            width: 200px;
        }

        main {
            background-color: lightgray;
            height: 850px;
        }

        #map {
            height: 10px;
        }
    </style>

</head>

<body>
    <div class="container mt-1">
        <header class="container">
            <!-- start header row 1 -->
            <section class="row">
                <!-- search box -->
                <div class="col-12 mt-2 input-group box">
                    <!-- TODO: fix search icon inside search box -->
                    <!-- <i class="fas fa-search"></i> -->
                    <input type="text " list="results" class="form-control list_of_locations"
                        placeholder="Type city to visit..." name="city" id="search" autocomplete="on">
                    <!-- autocomplete -->
                    <datalist id="results"> </datalist>
                    <!-- search button -->
                    <div class="input-group-append ">
                        <button class="btn bg-search px-5" id="btn_submit" type="submit "> Search </button>
                    </div>
                </div>
            </section>
            <!-- end header row 1 -->
            <!-- start header row 2 -->
            <section class="row mt-3">
                <!-- check-in -->
                <div class="input-group-append col-3 checkIn">
                    <div class="input-group">
                        <input data-datepicker class="form-control datepicker-input" id="checkInCal" type="date"
                            placeholder="Check-in">
                    </div>
                </div>
                <!-- check-out -->
                <div class="input-group-append col-3 checkOut">
                    <div class="input-group">
                        <input data-datepicker class="form-control datepicker-input" id="checkOutCal" type="date"
                            placeholder="Check-out">
                    </div>
                </div>
                <!-- room type -->
                <div class="form-group col-5">
                    <div class="form-group dropdown open">
                        <div
                            class="form-control btn-outline-light text-dark bg-light d-flex align-content-center justify-content-center">
                            <select name="roomtype" id="selectroomtype">
                                <option value="null" class="text-center">Select a room type...</option>
                            </select>
                        </div>
                    </div>
                </div>
            </section>
            <!-- end header row 2 -->
            <!-- start header helper row -->
            <section class="row ">
                <!-- slider labels -->
                <div class="col-3 mt-3">
                    <div class="header-titles">
                        <label for="slider">Price</label>
                        <label for="slider" class="text-right current_price" id="current_price">Max: €2,000</label>
                    </div>
                </div>
                <!-- property type label -->
                <div class="col-sm-2 mt-2 border-right border-secondary">
                    <label for="propertytype" class="header-titles">Property type</label>
                </div>
                <!-- guest rating label -->
                <div class="col-sm-2 mt-2 border-right border-secondary">
                    <label for="guestrating" class="header-titles">Guest rating</label>
                </div>
                <!-- hotel location label -->
                <div class="col-sm-5 mt-2 border-right border-secondary">
                    <label for="hotelLocation" class="header-titles">Hotel location</label>
                </div>
            </section>
            <!-- end header helper row -->
            <!-- start header row 3 -->
            <section class="row">
                <!-- slider -->
                <div class="col-3 form-group">
                    <input  type="range" id="price" min="30" max="2000" value="2000">
                </div>
                <!-- property type -->
                <div class="form-group col-2 dropdown">
                    <select
                        class="bg-transparent border-0 text-white form-control propertytype fa dropdown-toggle  text-center"
                        name="propertytype" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"
                        id="propertytype">
                        <option selected value="0" class="header-titles bg-top text-white fa">All

                        </option>
                        <option value="0" class="bg-top text-dark fa"> &#10032; &#10032; &#10032; &#10032; &#10032;
                            0/5
                        </option>
                        <option value="1" class="bg-top text-dark fa">&#9733; &#10032; &#10032; &#10032; &#10032;
                            1/5
                        </option>
                        <option value="2" class="bg-top text-dark fa">&#9733; &#9733; &#10032; &#10032; &#10032;
                            2/5
                        </option>
                        <option value="3" class="bg-top text-dark fa">&#9733; &#9733; &#9733; &#10032; &#10032;
                            3/5
                        </option>
                        <option value="4" class="bg-top text-dark fa">&#9733; &#9733; &#9733; &#9733; &#10032;
                            4/5
                        </option>
                        <option value="5" class="bg-top text-dark fa">&#9733; &#9733; &#9733; &#9733; &#9733;
                            5/5
                        </option>
                    </select>
                </div>
                <!-- guest rating -->
                <div class="col-2 form-group">
                    <select
                        class="bg-transparent border-0 text-white form-control fa dropdown-toggle guestrating text-center"
                        aria-haspopup="true" aria-expanded="false" name="guestrating " id="guestrating ">
                        <option selected value="All" class="bg-top text-white fa">All</option>
                        <option value="Okay" class="bg-top text-dark fa">0-2 Okay</option>
                        <option value="Fair" class="bg-top text-dark fa">2-6 Fair</option>
                        <option value="Good" class="bg-top text-dark fa">6-7 Good</option>
                        <option value="Very Good" class="bg-top text-dark fa">7-8.5 Very Good</option>
                        <option value="Excellent" class="bg-top text-dark fa">8.5-10 Excellent</option>
                    </select>
                </div>
                <!-- hotel location -->
                <div class="col-5 form-group dropdown open">
                    <select
                        class="bg-transparent border-0 form-control btn-outline-light text-white bg-light d-flex align-content-center justify-content-center list_of_locations"
                        aria-haspopup="true" aria-expanded="false" name="hotelLocation " id="hotelLocation ">
                        <option value="null" class="text-center">Select hotel location...</option>
                    </select>
                </div>
            </section>
            <!-- end header row 3 -->
        </header>
        <main class="container">
            <!-- start main row 1 -->
            <section class="row">
                <div class="col-sm-3 mt-3 d-flex justify-content-start" id="map">
                    <!-- map -->
                    <iframe class="form-control position-sticky border-0 " width="100" height="50"
                        src="https://www.google.com/maps/embed?pb=!1m14!1m12!1m3!1d83998.94722687619!2d2.277019841665155!3d48.8588377391234!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!5e0!3m2!1sen!2sgr!4v1554987763683!5m2!1sen!2sgr">
                    </iframe>
                    <button type="button" id="btn_map"
                        class="btn btn-sm btn-light border-secondary text-dark position-absolute" data-toggle="modal"
                        data-target="#map_modal">
                        View Map
                    </button>
                    <!-- modal with iframe map -->
                    <div id="map_modal" class="modal fade" tabindex="-1" aria-hidden="true">
                        <div class="modal-dialog modal-dialog-centered">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title">Location Map</h5>
                                    <button type="button" class="close" data-dismiss="modal">
                                        <span>&times;</span>
                                    </button>
                                </div>
                                <div class="modal-body">
                                    <div class="d-flex justify-content-center align-items-center">
                                        <iframe class="border-0 h-100 w-100"
                                            src="https://www.google.com/maps/embed?pb=!1m14!1m12!1m3!1d83998.94722687619!2d2.277019841665155!3d48.8588377391234!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!5e0!3m2!1sen!2sgr!4v1554987763683!5m2!1sen!2sgr">
                                        </iframe>
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <button class="btn btn-secondary" data-dismiss="modal">OK</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- end of modal with iframe map -->
                </div>
                <!-- filtering -->
                <div class=" col-sm-5 mt-4 offset-4 d-flex justify-content-end">
                    <div class="input-group">
                        <div class="input-group-prepend pr-2 text-center align-self-center">Sort by</div>
                        <!-- <div class="form-control align-self-center input-group-full d-flex "> -->
                        <select id="selectChar" name="selectChar"
                            class="selectChar form-control input-group-full d-flex align-content-center justify-content-center d-inline-block">
                            <!-- append html options -->
                        </select>
                        <!-- </div> -->
                        <div class="input-goup-append text-center align-self-center pl-2" id="infoIcon">
                            <i class="fas fa-info-circle"></i>
                        </div>
                    </div>
                </div>
            </section>
            <!-- end main row 1 -->
            <!-- start row with hotel templates -->
            <section id="hotelsList">

            </section>
        </main>
    </div>
    <!-- <script src="functionalities.js"></script> -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script>
        jQuery(function ($) {
            $.getJSON("data.json", function (data) {
                let hotelData;
                function toJSON(response) {
                    return response.json();
                }

                function initApp(data) {
                    console.log(data);
                    hotelData = data;
                    const hotels = data[1].entries;
                    // console.log( hotels );
                }
                function handleErrors(error) {

                }
                // Load data from data.json
                fetch("data.json")
                    .then(toJSON)
                    .then(initApp)
                    .catch(handleErrors);

                //slider price viewer
                const inputEl = document.querySelector("#price");
                const label = document.querySelector("#current_price");

                inputEl.addEventListener("input", (e) => {
                    console.log(typeof e.currentTarget.value);
                    label.innerText = e.currentTarget.value;
                });


                inputEl.addEventListener("change", (e) => {
                    console.log(e.currentTarget.value);
                });

                //show the hotels
                const hotels = data[1].entries;
                console.log(hotels);
                let dataOfHotels = "";
                hotels.forEach(hotel => {
                    dataOfHotels += listHotels(hotel);
                })
                $("#hotelsList").empty().html(dataOfHotels);

                // excluding double cities
                const uniqueCities = [];
                hotels.forEach(e => {
                    uniqueCities.push(e.city);
                });
                const finalCities = [...new Set(uniqueCities)];

                const datalist = document.querySelector("#results");
                let options = "";
                for (let i = 0; i < finalCities.length; i++) {
                    const option = "<option value='" + finalCities[i] + "'/>";
                    options += option;
                    // console.log(options);
                }
                document.getElementById("results").innerHTML = options;

                // populating the Room Type options
                const typeOfRoom = data[0].roomtypes;
                typeOfRoom.forEach(room => {

                    $('#selectroomtype').append($('<option>', {
                        // value: room.name,
                        class: "text-center text-dark",
                        text: room.name
                    }));
                });

                // populating the Hotel Location options
                let requestedLocations = '<option value="Select City" class="text-black bg-top fa">Select City...</option>';
                for (let i = 0; i < finalCities.length; i++) {
                    requestedLocations += '<option value="' + finalCities[i] + '" class="bg-top text-dark fa">' + finalCities[i] + "</option >"
                }
                $(".list_of_locations").empty().html(requestedLocations);

                // get unique characteristics from all hotels filters
                let temp_characteristics = [];
                hotels.forEach(element => {
                    element.filters.forEach(el => {
                        temp_characteristics.push(el.name);
                    })
                })
                const hasCharacteristics = [...new Set(temp_characteristics)];

                // populating the Sort by box
                let characteristics = '<option selected value="Select characteristics...">Select characteristics...</option>';
                for (let i = 0; i < hasCharacteristics.length; i++) {
                    characteristics += '<option value="' + hasCharacteristics[i] + '" class="text-black bg-white">' + hasCharacteristics[i] + "</option >"
                }
                $(".selectChar").empty().html(characteristics);


                // get the user's options on city to visit, price, property type, hotel location, characteristics, ratings, guestratings
                // selected city to visit - hotel location
                let selectedLocation = "All";
                $(".list_of_locations").on("click", function () {
                    selectedLocation = $(".list_of_locations").val()
                });

                // selected price
                let selectedPrice = "";
                $("#current_price").on("click", function () {
                    selectedPrice = $("#current_price").val()
                })

                // selected property type
                let selectedType = "";
                $("#selectroomtype").on("click", function () {
                    selectedType = $(".selectedroomtype").val()
                });

                // selected characteristic
                let selectedCharacteristic = "";
                $("#selectChar").on("click", function () {
                    selectedCharacteristic = $(".selectChar").val()
                });

                // selected ratings
                let selectedRating = 0;
                $(".propertytype").on("click", function () {
                    selectedRating = $(".propertytype").val();
                });

                // selected guestratings
                let selectedGuestRating = "All";
                $(".guestrating").on("click", function () {
                    selectedGuestRating = $(".guestrating").val();
                });

                // filter the hotels
                function filtering(hotelData, selectedLocation, selectedRating, selectedCharacteristic, selectedGuestRating) {
                    const tempHotelList = [];
                    hotelData.forEach(hotel => {
                        if (hotel.city === selectedLocation  && hotel.guestrating === parseFloat(selectedRating) && hotel.filters.name === selectedCharacteristic )
                            if (selectedGuestRating === "All") {
                                tempHotelList.push(hotel);
                            }
                            else if (selectedGuestRating === "Okay") {
                                tempHotelList.push(hotel);
                            }
                            else if (selectedGuestRating === "Fair") {
                                tempHotelList.push(hotel);
                            }
                            else if (selectedGuestRating === "Good") {
                                tempHotelList.push(hotel);
                            }
                            else if (selectedGuestRating === "Very Good") {
                                tempHotelList.push(hotel);
                            }
                            else if (selectedGuestRating === "Excellent") {
                                tempHotelList.push(hotel);
                            }
                    })
                    return tempHotelList;
                }

                // on pressing the search button
                $("#btn_submit").on("click", function (e) {
                    const results = $("#hotelsList");
                    const newHotels = filtering(hotelData, selectedLocation, selectedRating, selectedCharacteristic, selectedGuestRating);
                    let dataOfHotels = "";
                    newHotels.forEach(hotel => {
                        dataOfHotels += listHotels(hotel);
                    })
                    $("#hotelsList").empty().html(dataOfHotels);
                });

                // list the hotels dynamically in the arranged template
                function listHotels(hotel) {
                    const requestedHotels = `
                    <div class="container result_card">
                        <div class="row border-secondary border bg-white">
                            <img src="${hotel.thumbnail}" alt="hotel image"
                            class="img-thumbnail col-3 m-0 p-1">
                            <div
                                class="col-4 border-right mt-2 mb-2 pb-3 d-flex flex-column justify-content-around align-items-stretch align-items-start">
                                <div>
                                    <h4 class="text-success font-weight-bolder">${hotel.hotelName}</h4>
                                </div>
                                <div>
                                    <span>
                                        <i class='${hotel.guestrating > 0 ? "fas fa-star text-warning" : "far fa-star text-warning"}'></i>
                                        <i class='${hotel.guestrating > 1 ? "fas fa-star text-warning" : "far fa-star text-warning"}'></i>
                                        <i class='${hotel.guestrating > 2 ? "fas fa-star text-warning" : "far fa-star text-warning"}'></i>
                                        <i class='${hotel.guestrating > 3 ? "fas fa-star text-warning" : "far fa-star text-warning"}'></i>
                                        <i class='${hotel.guestrating > 4 ? "fas fa-star text-warning" : "far fa-star text-warning"}'></i>
                                        Hotel
                                    </span>
                                </div>
                                <section>
                                    ${hotel.city}
                                </section>
                                <section>
                                    <span class="text-success">${hotel.ratings.no}</span>
                                    ${hotel.ratings.text} (9 views)
                                </section>
                    
                            </div>
                            
                            <div class="col-5 mt-2 mb-2 d-flex flex-column justify-content-between align-items-center">
                                <div class="m-auto text-center">
                                    <div class="text-success">
                                        <span class="text-success" >Hotel Website </span>
                                    </div>
                                    <div class="text-success">
                                        € ${hotel.price}
                                    </div>
                                    <div>
                                        3 nights for <span class="text-success">€ ${(hotel.price) * 3}</span>
                                    </div>
                                </div>
                                <button class="btn btn-success font-weight-bolder">View Deal
                                </button>
                            </div>
                        </div>
                    </div>`
                    return requestedHotels;
                }
            })
        });


    </script>
</body>

</html>